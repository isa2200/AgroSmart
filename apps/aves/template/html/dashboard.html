{% extends 'aves/base.html' %}
{% load static %}

{% block title %}Dashboard Avícola - AgroSmart{% endblock %}

{% block page_title %}Dashboard Avícola{% endblock %}

{% block breadcrumb_items %}
    <li class="breadcrumb-item active">Dashboard</li>
{% endblock %}

{% block content %}
<!-- Métricas Principales -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card text-white bg-primary">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h4 class="card-title">{{ total_lotes }}</h4>
                        <p class="card-text">Lotes Activos</p>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-layer-group fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card text-white bg-success">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h4 class="card-title">{{ total_aves|floatformat:0 }}</h4>
                        <p class="card-text">Total Aves</p>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-dove fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card text-white bg-warning">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h4 class="card-title">{{ produccion_hoy|floatformat:0 }}</h4>
                        <p class="card-text">Producción Hoy</p>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-egg fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card text-white bg-danger">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h4 class="card-title">{{ alertas_pendientes }}</h4>
                        <p class="card-text">Alertas Pendientes</p>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-exclamation-triangle fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Gráficos y Datos -->
<div class="row">
    <!-- Inventario de Huevos -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-boxes me-2"></i>Inventario de Huevos</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Tipo</th>
                                <th>Cantidad</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for inventario in inventario_huevos %}
                            <tr>
                                <td>{{ inventario.tipo_huevo }}</td>
                                <td>{{ inventario.cantidad_disponible }}</td>
                                <td>
                                    {% if inventario.cantidad_disponible > 100 %}
                                        <span class="badge bg-success">Bueno</span>
                                    {% elif inventario.cantidad_disponible > 50 %}
                                        <span class="badge bg-warning">Medio</span>
                                    {% else %}
                                        <span class="badge bg-danger">Bajo</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="3" class="text-center">No hay datos disponibles</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Vacunas Pendientes -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-syringe me-2"></i>Vacunación</h5>
            </div>
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <span>Vacunas Pendientes (próximos 7 días)</span>
                    <span class="badge bg-warning fs-6">{{ vacunas_pendientes }}</span>
                </div>
                
                {% if vacunas_pendientes > 0 %}
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Hay {{ vacunas_pendientes }} vacuna{{ vacunas_pendientes|pluralize }} pendiente{{ vacunas_pendientes|pluralize }} para aplicar.
                        <a href="{% url 'aves:plan_vacunacion_list' %}" class="alert-link">Ver detalles</a>
                    </div>
                {% else %}
                    <div class="alert alert-success">
                        <i class="fas fa-check-circle me-2"></i>
                        No hay vacunas pendientes para los próximos 7 días.
                    </div>
                {% endif %}
                
                <div class="d-grid">
                    <a href="{% url 'aves:plan_vacunacion_create' %}" class="btn btn-primary">
                        <i class="fas fa-plus me-2"></i>Programar Vacuna
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Acciones Rápidas -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-bolt me-2"></i>Acciones Rápidas</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <div class="d-grid">
                            <a href="{% url 'aves:bitacora_create' %}" class="btn btn-outline-primary">
                                <i class="fas fa-plus me-2"></i>Nueva Bitácora
                            </a>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="d-grid">
                            <a href="{% url 'aves:lote_create' %}" class="btn btn-outline-success">
                                <i class="fas fa-layer-group me-2"></i>Nuevo Lote
                            </a>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="d-grid">
                            <a href="{% url 'aves:movimiento_huevos_create' %}" class="btn btn-outline-warning">
                                <i class="fas fa-exchange-alt me-2"></i>Movimiento Huevos
                            </a>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="d-grid">
                            <a href="{% url 'aves:reportes' %}" class="btn btn-outline-info">
                                <i class="fas fa-chart-bar me-2"></i>Ver Reportes
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // Auto-refresh cada 5 minutos
    setInterval(function() {
        location.reload();
    }, 300000);
});
</script>
{% endblock %}