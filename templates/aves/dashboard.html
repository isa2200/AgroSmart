{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard Avícola - AgroSmart{% endblock %}

{% block extra_css %}
<style>
    .sidebar {
        min-height: 100vh;
        background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
    }
    .sidebar .nav-link {
        color: #ecf0f1;
        padding: 12px 20px;
        border-radius: 8px;
        margin: 2px 0;
        transition: all 0.3s ease;
    }
    .sidebar .nav-link:hover {
        background-color: rgba(255,255,255,0.1);
        color: #fff;
    }
    .sidebar .nav-link.active {
        background-color: #3498db;
        color: #fff;
    }
    .main-content {
        background-color: #f8f9fa;
        min-height: 100vh;
    }
    .card {
        border: none;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .card-header {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        color: white;
        border-radius: 12px 12px 0 0 !important;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-md-2 sidebar p-0">
            <div class="p-3">
                <h6 class="text-light mb-3">
                    <i class="fas fa-egg me-2"></i>Módulo Avícola
                </h6>
                <nav class="nav flex-column">
                    <a class="nav-link active" href="{% url 'aves:dashboard' %}">
                        <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                    </a>
                    <a class="nav-link" href="{% url 'aves:bitacora_list' %}">
                        <i class="fas fa-clipboard-list me-2"></i>Bitácora Diaria
                    </a>
                    <a class="nav-link" href="{% url 'aves:lote_create' %}">
                        <i class="fas fa-layer-group me-2"></i>Lotes
                    </a>
                    <a class="nav-link" href="{% url 'aves:inventario_huevos' %}">
                        <i class="fas fa-boxes me-2"></i>Inventario Huevos
                    </a>
                    <a class="nav-link" href="{% url 'aves:plan_vacunacion_list' %}">
                        <i class="fas fa-syringe me-2"></i>Vacunación
                    </a>
                    <a class="nav-link" href="{% url 'aves:alertas_list' %}">
                        <i class="fas fa-bell me-2"></i>Alertas
                    </a>
                    <a class="nav-link" href="{% url 'aves:reportes' %}">
                        <i class="fas fa-chart-bar me-2"></i>Reportes
                    </a>
                </nav>
                
                <hr class="my-3" style="border-color: rgba(255,255,255,0.2);">
                
                <nav class="nav flex-column">
                    <a class="nav-link" href="{% url 'dashboard:principal' %}">
                        <i class="fas fa-home me-2"></i>Volver al Dashboard
                    </a>
                </nav>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="col-md-10 main-content">
            <div class="p-4">
                <!-- Breadcrumb -->
                <nav aria-label="breadcrumb" class="mb-4">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="{% url 'dashboard:principal' %}">Inicio</a></li>
                        <li class="breadcrumb-item active">Dashboard Avícola</li>
                    </ol>
                </nav>

                <!-- Page Header -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="mb-0">Dashboard Avícola</h2>
                </div>

                <!-- Métricas Principales -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card text-white bg-primary">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h4 class="card-title">{{ total_lotes }}</h4>
                                        <p class="card-text">Lotes Activos</p>
                                    </div>
                                    <div class="align-self-center">
                                        <i class="fas fa-layer-group fa-2x"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3">
                        <div class="card text-white bg-success">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h4 class="card-title">{{ total_aves|floatformat:0 }}</h4>
                                        <p class="card-text">Total Aves</p>
                                    </div>
                                    <div class="align-self-center">
                                        <i class="fas fa-dove fa-2x"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3">
                        <div class="card text-white bg-warning">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h4 class="card-title">{{ produccion_hoy|floatformat:0 }}</h4>
                                        <p class="card-text">Producción Hoy</p>
                                    </div>
                                    <div class="align-self-center">
                                        <i class="fas fa-egg fa-2x"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3">
                        <div class="card text-white bg-danger">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h4 class="card-title">{{ alertas_pendientes }}</h4>
                                        <p class="card-text">Alertas Pendientes</p>
                                    </div>
                                    <div class="align-self-center">
                                        <i class="fas fa-exclamation-triangle fa-2x"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gráficos y Datos -->
                <div class="row">
                    <!-- Inventario de Huevos -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-boxes me-2"></i>Inventario de Huevos</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-sm">
                                        <thead>
                                            <tr>
                                                <th>Tipo</th>
                                                <th>Cantidad</th>
                                                <th>Estado</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for inventario in inventario_huevos %}
                                            <tr>
                                                <td>{{ inventario.tipo_huevo }}</td>
                                                <td>{{ inventario.cantidad_disponible }}</td>
                                                <td>
                                                    {% if inventario.cantidad_disponible > 100 %}
                                                        <span class="badge bg-success">Bueno</span>
                                                    {% elif inventario.cantidad_disponible > 50 %}
                                                        <span class="badge bg-warning">Medio</span>
                                                    {% else %}
                                                        <span class="badge bg-danger">Bajo</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            {% empty %}
                                            <tr>
                                                <td colspan="3" class="text-center">No hay datos disponibles</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Vacunas Pendientes -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-syringe me-2"></i>Vacunación</h5>
                            </div>
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <span>Vacunas Pendientes (próximos 7 días)</span>
                                    <span class="badge bg-warning fs-6">{{ vacunas_pendientes }}</span>
                                </div>
                                
                                {% if vacunas_pendientes > 0 %}
                                    <div class="alert alert-warning">
                                        <i class="fas fa-exclamation-triangle me-2"></i>
                                        Hay {{ vacunas_pendientes }} vacuna{{ vacunas_pendientes|pluralize }} pendiente{{ vacunas_pendientes|pluralize }} para aplicar.
                                        <a href="{% url 'aves:plan_vacunacion_list' %}" class="alert-link">Ver detalles</a>
                                    </div>
                                {% else %}
                                    <div class="alert alert-success">
                                        <i class="fas fa-check-circle me-2"></i>
                                        No hay vacunas pendientes para los próximos 7 días.
                                    </div>
                                {% endif %}
                                
                                <div class="d-grid">
                                    <a href="{% url 'aves:plan_vacunacion_create' %}" class="btn btn-primary">
                                        <i class="fas fa-plus me-2"></i>Programar Vacuna
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Acciones Rápidas -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-bolt me-2"></i>Acciones Rápidas</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3 mb-3">
                                        <div class="d-grid">
                                            <a href="{% url 'aves:bitacora_create' %}" class="btn btn-outline-primary">
                                                <i class="fas fa-plus me-2"></i>Nueva Bitácora
                                            </a>
                                        </div>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <div class="d-grid">
                                            <a href="{% url 'aves:lote_create' %}" class="btn btn-outline-success">
                                                <i class="fas fa-layer-group me-2"></i>Nuevo Lote
                                            </a>
                                        </div>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <div class="d-grid">
                                            <a href="{% url 'aves:movimiento_huevos_create' %}" class="btn btn-outline-warning">
                                                <i class="fas fa-exchange-alt me-2"></i>Movimiento Huevos
                                            </a>
                                        </div>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <div class="d-grid">
                                            <a href="{% url 'aves:reportes' %}" class="btn btn-outline-info">
                                                <i class="fas fa-chart-bar me-2"></i>Ver Reportes
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // Auto-refresh cada 5 minutos
    setInterval(function() {
        location.reload();
    }, 300000);
});
</script>
{% endblock %}